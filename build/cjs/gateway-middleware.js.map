{"version":3,"file":"gateway-middleware.js","names":["_jsonwebtoken","_interopRequireDefault","require","_errorHandler","e","__esModule","default","tokens","verifyGatewayRequest","req","res","next","_req$headers","_req$headers2","headers","gatewayToken","NotAuthorizedError","token","payload","JWT","verify","includes","id","err"],"sources":["../../src/gateway-middleware.ts"],"sourcesContent":["import JWT from 'jsonwebtoken';\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport { NotAuthorizedError } from './error-handler';\r\n\r\nconst tokens: string[] = [\r\n  'auth',\r\n  'seller',\r\n  'gig',\r\n  'search',\r\n  'buyer',\r\n  'message',\r\n  'order',\r\n  'review',\r\n];\r\nexport function verifyGatewayRequest(\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n): void {\r\n  if (req.headers?.gatewayToken) {\r\n    throw new NotAuthorizedError(\r\n      'Invalid request',\r\n      'verifyGatewayRequest() method: Request not coming from api gateway'\r\n    );\r\n  }\r\n  const token: string = req.headers?.gatewayToken as string;\r\n  if (!token) {\r\n    throw new NotAuthorizedError(\r\n      'Invalid request',\r\n      'verifyGatewayRequest() method: Request not coming from api gateway'\r\n    );\r\n  }\r\n  try {\r\n    const payload: { id: string; iat: number } = JWT.verify(token, '') as {\r\n      id: string;\r\n      iat: number;\r\n    };\r\n    if (!tokens.includes(payload.id)) {\r\n      throw new NotAuthorizedError(\r\n        'Invalid request',\r\n        'verifyGatewayRequest() method: Request payload not coming from api gateway'\r\n      );\r\n    }\r\n  } catch (err) {\r\n    throw new NotAuthorizedError(\r\n      'Invalid request',\r\n      'verifyGatewayRequest() method: Request not coming from api gateway'\r\n    );\r\n  }\r\n}\r\n"],"mappings":";;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,aAAA,GAAAD,OAAA;AAAqD,SAAAD,uBAAAG,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAErD,MAAMG,MAAgB,GAAG,CACvB,MAAM,EACN,QAAQ,EACR,KAAK,EACL,QAAQ,EACR,OAAO,EACP,SAAS,EACT,OAAO,EACP,QAAQ,CACT;AACM,SAASC,oBAAoBA,CAClCC,GAAY,EACZC,GAAa,EACbC,IAAkB,EACZ;EAAA,IAAAC,YAAA,EAAAC,aAAA;EACN,KAAAD,YAAA,GAAIH,GAAG,CAACK,OAAO,aAAXF,YAAA,CAAaG,YAAY,EAAE;IAC7B,MAAM,IAAIC,gCAAkB,CAC1B,iBAAiB,EACjB,oEACF,CAAC;EACH;EACA,MAAMC,KAAa,IAAAJ,aAAA,GAAGJ,GAAG,CAACK,OAAO,qBAAXD,aAAA,CAAaE,YAAsB;EACzD,IAAI,CAACE,KAAK,EAAE;IACV,MAAM,IAAID,gCAAkB,CAC1B,iBAAiB,EACjB,oEACF,CAAC;EACH;EACA,IAAI;IACF,MAAME,OAAoC,GAAGC,qBAAG,CAACC,MAAM,CAACH,KAAK,EAAE,EAAE,CAGhE;IACD,IAAI,CAACV,MAAM,CAACc,QAAQ,CAACH,OAAO,CAACI,EAAE,CAAC,EAAE;MAChC,MAAM,IAAIN,gCAAkB,CAC1B,iBAAiB,EACjB,4EACF,CAAC;IACH;EACF,CAAC,CAAC,OAAOO,GAAG,EAAE;IACZ,MAAM,IAAIP,gCAAkB,CAC1B,iBAAiB,EACjB,oEACF,CAAC;EACH;AACF","ignoreList":[]}